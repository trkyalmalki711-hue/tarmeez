{% include "partials/header.html" %}

<div class="card section" style="margin-top:18px">
  <h3 data-en="ICD-10 Search" data-ar="بحث ICD-10">ICD-10 Search</h3>
  <div class="small" style="margin-top:6px" data-en="Search diagnosis code or description" data-ar="ابحث بكود التشخيص أو الوصف">Search diagnosis code or description</div>

  <div style="margin-top:12px">
    <input
      class="input"
      id="q"
      type="text"
      data-ph-en="Search ICD-10..."
      data-ph-ar="ابحث في ICD-10..."
      placeholder="Search ICD-10..."
      oninput="searchICD()"
    />
  </div>

  <div id="results" style="margin-top:14px"></div>
</div>

<script>
  let t=null;
  async function searchICD(){
    clearTimeout(t);
    t=setTimeout(async()=>{
      const q=document.getElementById('q').value.trim();
      if(q.length<2){ document.getElementById('results').innerHTML=''; return; }
      try{
        const res=await fetch(`/search/icd?q=${encodeURIComponent(q)}&limit=10`);
        const data=await res.json();
        const items=(data.results||[]);
        if(!items.length){
          document.getElementById('results').innerHTML=`<div class="small" data-en="No results" data-ar="لا توجد نتائج">No results</div>`;
          if(window.Tarmeez) window.Tarmeez.applyI18n?.();
          return;
        }
        document.getElementById('results').innerHTML = items.map(r=>`
          <div class="card section" style="margin-bottom:10px">
            <div style="display:flex; justify-content:space-between; gap:12px">
              <strong>${r.code}</strong>
              <span class="small">ICD</span>
            </div>
            <div class="small" style="margin-top:6px">${r.description||''}</div>
          </div>
        `).join('');
      }catch(e){
        document.getElementById('results').innerHTML=`<div class="small" style="color:var(--bad)">Error loading results</div>`;
      }
    }, 250);
  }
</script>

{% include "partials/footer.html" %}
